---
title: "<span style='font-size: 27px'>**Module M.2** Descriptive statistics" 
author:
  - name: "Raisa Hern&#225;ndez-Pacheco, Alexandra L. Bland"
    affiliation: Introduction to Primate Data Exploration and Linear Modeling with R
output:
  html_document: default
  pdf_document: default
---

<style type="text/css">
.main-container {
  max-width: 800px;
}
pre code, pre, code {
  white-space: pre !important;
  overflow-x: scroll !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}
/* Whole document: */
body{
  font-family: helvetica;
  font-size: 12pt;
}
code {white-space:pre !important; overflow-x:scroll !important;font-size:12pt; font-family:courier;}

</style>


<br><br>
<style>
body {
text-align: justify}
div.blue { background-color: rgb(190,215,203); border-radius: 5px; padding: 20px;max-width: 800px; vertical-align: middle}
</style>
<div class = "blue"> 


<span style='color:rgb(102,0,0); font-size:120%; font-weight:600'> Introduction: </span> *Descriptive statistics* are a basic tool to generate summaries of each variable of interest. Summarizing data appropriately is a fundamental step towards understanding the features of the data (e.g., central location, spread, type of distribution), and the underlying mechanisms driving such features.     

In this module, you will practice tools for data exploration and descriptive statistics while summarizing demographic variables of the Cayo Santiago rhesus macaque population. 

</div>

***

<br>

**Upon completion of this module, you will be able to:**

  + Describe the central location and spread of a data set;
  + Estimate counts of observations;
  + Manage date data and describe statistics across dates;
  + Generate tables of descriptive statistics.

<br>

**References:**

  + [RStudio](https://posit.co/products/open-source/rstudio/)
  + [rstatix](https://cran.r-project.org/web/packages/rstatix/index.html)
  + [Tidyverse R packages for data science](https://www.tidyverse.org)

<br>

**Associated literature:**

  + [Rawlins and Kessler 1986. Reproductive performance, population dynamics and anthropometrics of the free-ranging Cayo Santiago rhesus macaques]( https://onlinelibrary.wiley.com/doi/full/10.1111/j.1600-0684.1984.tb00145.x?casa_token=FsxtddkB8fcAAAAA%3AKeiTwlqLt5AcnkvjXcCYavOIp2R4iJK_4aMXmuqQJmMANnXWz6wWMbwVxG2yJ9yhk-jqfDLEK0MBt0U)
  
<br>

<details>
  <summary><span style='color:"black"; font-size:100%; font-weight:550'> **Expand for R Notation and functions index** </span></summary>

<p>

**Notation:**

  + **[]** for subsets by columns;
  + **$** for accessing or creating a variable in a dataset.

<br>

**Functions:**

  + Base R:
  
    + **as.Date()** for converting into date variables;
    + **format()** for formatting date columns;
    + **install.packages()** for installing packages;
    + **length** for determining the length of a column;
    + **library()** for loading packages;
    + **rbind()** for row binding data frames.

<p>

  + rstatix:
  
    + **get_summary_stats()** for summarizing a continuous variable

<p>

  + tidyverse:
  
    + **filter()** for subsets by rows;
    + **group_by()** for grouping variables;
    + **mutate()** for creating conditional variables
    + **%>%** for combining multiple commands.
 
</details>

<br>

***

<br>

<div align="center"> 
### Summarizing the Cayo Santiago rhesus macaque demographic data  
</div>

<br>

In this module, you will be using the dataset **cs_demo_updated.RData** you exported in **Step 8** of **Module M.1** to summarize important demographic variables and generate assumptions of their distribution. This is a subset of the Cayo Santiago rhesus macaque demographic data for birth season 2010 (Table 1) with the additional variable of age for those individuals alive in February 1, 2023 (variables **feb23age** and **feb23age_b**). This is authentic data collected through daily visual censuses performed by the staff of the Caribbean Primate Research Center (CPRC) of the University of Puerto Rico-Medical Sciences Campus. 

<p>

Before coding, explore the data in Table 1.

<br>

**Table 1: Cayo Santiago demographic data**
<br>
<style>
body {
text-align: justify}
div.yellow { background-color:rgb(240,211,139); border-radius: 5px; padding: 20px;}
</style>
<div class = "yellow">

```{r,message=FALSE,echo=FALSE}
library(DT)
library(tidyverse)
load("cs_demo_updated.RData") 
datatable(cs_demo,rownames = FALSE, filter="top", options = list(pageLength = 5, scrollX=T)) %>% 
  formatStyle(columns = colnames(.$x$data), `font-size` = '13px')
```
</div>

**Metadata of cs_demo:** Demographic data of rhesus macaques born during the 2010 birth season. The data is shared by the CPRC and last updated in February 1, 2023.
  
  + dob: date of birth
  + season: annual birth season
  + sex: f=female; m=male
  + dor: date when culled
  + dod: date at death
  + status: final fate of the individual
  + feb23age: age of individuals alive in February 1, 2023
  + feb23age_b: age of individuals alive in February 1, 2023

***

<br>

### 1. Descriptive statistics using base R

Functions from base **R** can be used to estimate descriptive statistics. As a refresher, below you will estimate the central location and spread of the distribution of age for individuals alive in February 1, 2023.   
```{r,eval=FALSE}
# summary of age
summary(cs_demo$feb23age)

# mean age
m <- mean(cs_demo$feb23age, na.rm = TRUE) #removing NAs
m

# median age
med <- median(cs_demo$feb23age, na.rm = TRUE) #removing NAs
med

# variance around mean age
v <- var(cs_demo$feb23age, na.rm = TRUE)
v

# standard deviation around mean age
sdev <- sd(cs_demo$feb23age, na.rm = TRUE)
sdev
```

<br>

**Guiding questions:**

a) *Is the distribution of age for the cohort born in 2010 normally distributed?* 

<p>

<details>
<summary><span style='color:#D89000; font-size:100%; font-weight:500'> Click for Answer! </span></summary>

Age in February 1, 2023 seems to be normally distributed as the mean and the median are similar and the 1st and 3rd quartiles suggest symmetry around the central location. This is expected for a cohort that is born in synchrony.

</details>

<br>

Note that these functions can be incorporated into more other functions. Below you will use learned *tidyverse* functions to estimate the standard error of the mean.
```{r,eval=FALSE}
# loading tidyverse
library(tidyverse)

# filtering individuals alive
alive <- filter(cs_demo, status=="IN CS")

# length of the first column (= sample size)
n <- length(alive[,1])

# standard error of the mean
se <- sdev/sqrt(n)
se
```

<br>

**Guiding questions:**

a) *The standard error represents the precision of the sample mean, is the sample mean relative precise? Why?* 

<p>

<details>
  <summary><span style='color:#D89000; font-size:100%; font-weight:500'> Click for Answer! </span></summary>

Yes. The SE is relatively low. This is expected from a synchronized birth cohort. Must ages will be similar to each other. 

</details>

<br>

### 2. Descriptive statistics with *tidyverse* and *rstatix*

When exploring continuous variables, you can create a table of descriptive statistics using **R** packages *rstatix* and *tidyverse*. For this, you will use pipes and the function **group_by()** from *tidyverse*, followed by the function **get_summary_stats()** from *rstatix*.  

Below, you will generate a table with the summary statistics for age in February 1, 2023 for each sex.
```{r,eval=FALSE}
# installing rstatix
install.packages("rstatix",repos="http://cran.us.r-project.org")

# loading rstatix
library(rstatix)

# summary statistics for age across sex
sum <- cs_demo %>% 
      group_by(sex) %>% #grouping variable (sex)
      get_summary_stats(feb23age) #summary of continues variables 'feb23age'

sum
```

<br>

**Guiding questions:**

a) *Can you describe each column in the tibble sum?* 

<p>

<details>
  <summary><span style='color:#D89000; font-size:100%; font-weight:500'> Click for Answer! </span></summary>

To get the information from the source, you can always use **?** to get the information in CRAN:
```{r,eval=FALSE}
# help window
?get_summary_stats
```

**sex**: categorical variable for groups; **variable**: the variable being summarized; **n**: sample size across groups; **min**: minimum value; **max**: maximum value; **median**: median; **q1**: first quartile; **q3**: third quartile;
**iqr**: interquartile range; **mad**: median absolute deviation; **mean**: median
**sd**: standard deviation; **se**: standard error of the mean; **ci**: 95% confidence intervals of the mean.

</details>

<br>

### 3. Descriptive statistics across *date* variables

When exploring date variables, you want to make sure they are 'read' by **R** as such. For this, you can use the function **as.Date()**. In some occasions, you may want to decompose the date information into year, month, and day for easier management. For this, you will use the function **format()**.

Below, you will generate a summary statistics table for age across sex and month of birth.
```{r,eval=FALSE}
# extracting month info from dob
cs_demo$month <- format(as.Date(cs_demo$dob),"%m")

# extracting year info from dob
cs_demo$year <- format(as.Date(cs_demo$dob),"%Y")

# viewing the updated data frame
View(cs_demo)

# summary statistics for age across sex and month of birth
sum2 <- cs_demo %>% 
      group_by(sex,month) %>% #grouping by sex and month
      get_summary_stats(feb23age) 

sum2

# summary statistics for age across sex and year of birth
sum3 <- cs_demo %>% 
      group_by(sex,year) %>% #grouping by sex and year
      get_summary_stats(feb23age) 

sum3
```

<br>


**Guiding questions:**

a) *Why NAs in some of the stats are expected?* 

<p>

<details>
  <summary><span style='color:#D89000; font-size:100%; font-weight:500'> Click for Answer! </span></summary>

NAs are expected because there is not enough sample size in some groups to estimate the variance and errors. Look a t the column "n" in *sum2* and *sum3*.

</details>

<br>

<span style='color:#BC3C29FF; font-size:150%; font-weight:600'> Challenge! </span>

1. Create a table with the following summary statistics:

    + age at death across sex
    + age at removal from the population across sex

**Hint**: You may combine (row bind) two different data frames or tbl_df into one using the function **rbind()**. However, this will work as long as both data frames have the same columns.

<br>

**Questions:** 

  + What is the mean and standard deviation of age at death across sex? 
  + Can you tell whether the age at death and age at removal are normally distributed?

<br>

<center>
**FIN**
</center>
<br>

***

**Acknowledgements:** The creation of this module was funded by the National Science Foundation DBI BRC-BIO award 2217812. Cayo Santiago is supported by the Office of Research Infrastructure Programs (ORIP) of the National Institutes of Health, grant 2 P40 OD012217, and the University of Puerto Rico (UPR), Medical Sciences Campus.
```{r echo=FALSE,fig.asp=1,fig.width = 2,out.width="30%",fig.align='center',message=FALSE}
library(png)
library(grid)
library(gridExtra)
img1 <-  rasterGrob(as.raster(readPNG("nsflogo.png")), interpolate = FALSE)
img2 <-  rasterGrob(as.raster(readPNG("cprclogo.png")), interpolate = FALSE)
grid.arrange(img1, img2, ncol = 2)
```

***
**Authors:** Raisa Hern&#225;ndez-Pacheco and Alexandra L Bland, California State University, Long Beach

